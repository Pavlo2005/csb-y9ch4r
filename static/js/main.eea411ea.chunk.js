(this["webpackJsonpgoit-textbook-lesson-15-16-auth-final"]=this["webpackJsonpgoit-textbook-lesson-15-16-auth-final"]||[]).push([[1],{12:function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var s=n(6),a=n(10),r=n.n(a);const c=Object(s.b)("tasks/fetchAll",(async(e,t)=>{try{return(await r.a.get("/tasks")).data}catch(n){return t.rejectWithValue(n.message)}})),i=Object(s.b)("tasks/addTask",(async(e,t)=>{try{return(await r.a.post("/tasks",{text:e})).data}catch(n){return t.rejectWithValue(n.message)}})),o=Object(s.b)("tasks/deleteTask",(async(e,t)=>{try{return(await r.a.delete("/tasks/".concat(e))).data}catch(n){return t.rejectWithValue(n.message)}}))},24:function(e,t,n){e.exports={link:"Navigation_link__12o2K",active:"Navigation_active__1Sofg"}},26:function(e,t,n){e.exports={wrapper:"UserMenu_wrapper__3KSXQ",username:"UserMenu_username__2nvIz"}},27:function(e,t,n){e.exports={link:"AuthNav_link__2ejsg",active:"AuthNav_active__2WI0M"}},41:function(e,t,n){e.exports={header:"AppBar_header__1Yk8v"}},8:function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u}));var s=n(10),a=n.n(s),r=n(6);a.a.defaults.baseURL="https://goit-task-manager.herokuapp.com/";const c=e=>{a.a.defaults.headers.common.Authorization="Bearer ".concat(e)},i=Object(r.b)("auth/register",(async(e,t)=>{try{const t=await a.a.post("/users/signup",e);return c(t.data.token),t.data}catch(n){return t.rejectWithValue(n.message)}})),o=Object(r.b)("auth/login",(async(e,t)=>{try{const t=await a.a.post("/users/login",e);return c(t.data.token),t.data}catch(n){return t.rejectWithValue(n.message)}})),l=Object(r.b)("auth/logout",(async(e,t)=>{try{await a.a.post("/users/logout"),a.a.defaults.headers.common.Authorization=""}catch(n){return t.rejectWithValue(n.message)}})),u=Object(r.b)("auth/refresh",(async(e,t)=>{const n=t.getState().auth.token;if(null===n)return t.rejectWithValue("Unable to fetch user");try{c(n);return(await a.a.get("/users/me")).data}catch(s){return t.rejectWithValue(s.message)}}))},82:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),r=n(37),c=n.n(r),i=n(11),o=n(2),l=n(40),u=n(9);const d=e=>e.auth.isLoggedIn,j=e=>e.auth.user,b=e=>e.auth.isRefreshing,h=()=>({isLoggedIn:Object(i.c)(d),isRefreshing:Object(i.c)(b),user:Object(i.c)(j)});var g=n(24),O=n.n(g),m=n(3);const p=()=>{const{isLoggedIn:e}=h();return Object(m.jsxs)("nav",{children:[Object(m.jsx)(u.b,{className:O.a.link,to:"/",children:"Home"}),e&&Object(m.jsx)(u.b,{className:O.a.link,to:"/tasks",children:"Tasks"})]})};var f=n(8),x=n(26),k=n.n(x);const y=()=>{const e=Object(i.b)(),{user:t}=h();return Object(m.jsxs)("div",{className:k.a.wrapper,children:[Object(m.jsxs)("p",{className:k.a.username,children:["Welcome, ",t.name]}),Object(m.jsx)("button",{type:"button",onClick:()=>e(Object(f.b)()),children:"Logout"})]})};var v=n(27),L=n.n(v);const _=()=>Object(m.jsxs)("div",{children:[Object(m.jsx)(u.b,{className:L.a.link,to:"/register",children:"Register"}),Object(m.jsx)(u.b,{className:L.a.link,to:"/login",children:"Log In"})]});var I=n(41),w=n.n(I);const R=()=>{const{isLoggedIn:e}=h();return Object(m.jsxs)("header",{className:w.a.header,children:[Object(m.jsx)(p,{}),e?Object(m.jsx)(y,{}):Object(m.jsx)(_,{})]})},N=()=>Object(m.jsxs)("div",{style:{maxWidth:960,margin:"0 auto",padding:"0 16px"},children:[Object(m.jsx)(R,{}),Object(m.jsx)(s.Suspense,{fallback:null,children:Object(m.jsx)(o.b,{})}),Object(m.jsx)(l.Toaster,{position:"top-right",reverseOrder:!1})]}),W=e=>{let{component:t,redirectTo:n="/"}=e;const{isLoggedIn:s,isRefreshing:a}=h();return!s&&!a?Object(m.jsx)(o.a,{to:n}):t},T=e=>{let{component:t,redirectTo:n="/"}=e;const{isLoggedIn:s}=h();return s?Object(m.jsx)(o.a,{to:n}):t},z=Object(s.lazy)((()=>n.e(7).then(n.bind(null,96)))),V=Object(s.lazy)((()=>Promise.all([n.e(0),n.e(6)]).then(n.bind(null,98)))),A=Object(s.lazy)((()=>Promise.all([n.e(0),n.e(5)]).then(n.bind(null,99)))),S=Object(s.lazy)((()=>Promise.all([n.e(0),n.e(4)]).then(n.bind(null,97)))),M=()=>{const e=Object(i.b)(),{isRefreshing:t}=h();return Object(s.useEffect)((()=>{e(Object(f.c)())}),[e]),t?Object(m.jsx)("b",{children:"Refreshing user..."}):Object(m.jsx)(o.e,{children:Object(m.jsxs)(o.c,{path:"/",element:Object(m.jsx)(N,{}),children:[Object(m.jsx)(o.c,{index:!0,element:Object(m.jsx)(z,{})}),Object(m.jsx)(o.c,{path:"/register",element:Object(m.jsx)(T,{redirectTo:"/tasks",component:Object(m.jsx)(V,{})})}),Object(m.jsx)(o.c,{path:"/login",element:Object(m.jsx)(T,{redirectTo:"/tasks",component:Object(m.jsx)(A,{})})}),Object(m.jsx)(o.c,{path:"/tasks",element:Object(m.jsx)(W,{redirectTo:"/login",component:Object(m.jsx)(S,{})})})]})})};var U=n(42),B=n(6),P=n(13),C=n(43),E=n.n(C),J=n(12);const K=e=>{e.isLoading=!0},H=(e,t)=>{e.isLoading=!1,e.error=t.payload},Q=Object(B.c)({name:"tasks",initialState:{items:[],isLoading:!1,error:null},extraReducers:{[J.c.pending]:K,[J.a.pending]:K,[J.b.pending]:K,[J.c.rejected]:H,[J.a.rejected]:H,[J.b.rejected]:H,[J.c.fulfilled](e,t){e.isLoading=!1,e.error=null,e.items=t.payload},[J.a.fulfilled](e,t){e.isLoading=!1,e.error=null,e.items.push(t.payload)},[J.b.fulfilled](e,t){e.isLoading=!1,e.error=null;const n=e.items.findIndex((e=>e.id===t.payload.id));e.items.splice(n,1)},[f.b.fulfilled](e){e.items=[],e.error=null,e.isLoading=!1}}}).reducer,X=Object(B.c)({name:"auth",initialState:{user:{name:null,email:null},token:null,isLoggedIn:!1,isRefreshing:!1},extraReducers:{[f.d.fulfilled](e,t){e.user=t.payload.user,e.token=t.payload.token,e.isLoggedIn=!0},[f.a.fulfilled](e,t){e.user=t.payload.user,e.token=t.payload.token,e.isLoggedIn=!0},[f.b.fulfilled](e){e.user={name:null,email:null},e.token=null,e.isLoggedIn=!1},[f.c.pending](e){e.isRefreshing=!0},[f.c.fulfilled](e,t){e.user=t.payload,e.isLoggedIn=!0,e.isRefreshing=!1},[f.c.rejected](e){e.isRefreshing=!1}}}).reducer,Y={key:"auth",storage:E.a,whitelist:["token"]},q=Object(B.a)({reducer:{auth:Object(P.g)(Y,X),tasks:Q},middleware:e=>e({serializableCheck:{ignoredActions:[P.a,P.f,P.b,P.c,P.d,P.e]}}),devTools:!1}),D=Object(P.h)(q);n(81),n(82);c.a.createRoot(document.getElementById("root")).render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(i.a,{store:q,children:Object(m.jsx)(U.a,{loading:null,persistor:D,children:Object(m.jsx)(u.a,{children:Object(m.jsx)(M,{})})})})}))}},[[83,2,3]]]);
//# sourceMappingURL=main.eea411ea.chunk.js.map